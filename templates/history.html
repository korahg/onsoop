<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>
    {% if selected_session %}
      ìƒë‹´ ê¸°ë¡ Â· {{ (selected_session['title'] or (selected_session['id'] ~ "íšŒì°¨")) }} Â· ë§ˆìŒì˜¨(å¿ƒ)
    {% else %}
      ìƒë‹´ ê¸°ë¡ Â· íšŒì°¨ ëª©ë¡ Â· ë§ˆìŒì˜¨(å¿ƒ)
    {% endif %}
  </title>
  <style>
    :root { --bg-color:#ffffff; --text-color:#1f2937; --muted-color:#6b7280; --border-color:#e5e7eb; --accent-color:#3b82f6; --panel-bg:#f9fafb; --bot-bubble:#f3f4f6; --user-bubble:#dbeafe; }
    * { box-sizing: border-box; }
    body { margin:0; background-color:var(--bg-color); color:var(--text-color); font-family:'Pretendard',system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif; }
    .wrap { max-width:960px; margin:40px auto; padding:0 16px; }
    .header-bar { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; gap:12px; }
    h1 { font-size:28px; margin:0; }
    .subtitle { color:var(--muted-color); font-size:14px; }
    .backlink { display:inline-flex; align-items:center; gap:6px; color:var(--accent-color); text-decoration:none; font-weight:600; }
    .card { background-color:var(--panel-bg); border:1px solid var(--border-color); border-radius:16px; padding:16px; box-shadow:0 4px 6px -1px rgba(0,0,0,.05); }
    .session-chip { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#eef2ff; color:#3730a3; font-weight:600; margin-top:8px; }
    .chat-window { height:75vh; overflow-y:auto; padding:0 10px; }
    .row { display:flex; margin-bottom:12px; gap:12px; align-items:flex-start; }
    .avatar { width:36px; height:36px; border-radius:50%; background-color:#e0e7ff; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
    .msg { padding:10px 14px; border-radius:12px; line-height:1.55; max-width:80%; white-space:pre-wrap; word-break:break-word; }
    .msg.bot { background-color:var(--bot-bubble); }
    .msg.user { background-color:var(--user-bubble); color:#1e3a8a; margin-left:auto; }
    .toolbar { display:flex; gap:8px; align-items:center; }
    .toolbar form { margin:0; }
    button, .btn { padding:0 16px; cursor:pointer; border:none; border-radius:12px; font-size:14px; font-weight:600; background-color:#e5e7eb; color:#374151; height:40px; text-decoration:none; display:inline-flex; align-items:center; justify-content:center; }
    .btn-primary { background-color:var(--accent-color); color:white; }
    .btn-danger { background:#fee2e2; color:#b91c1c; }

    /* ëª©ë¡ ì¹´ë“œ */
    .list { display:grid; grid-template-columns:1fr; gap:12px; }
    .item { display:flex; justify-content:space-between; align-items:center; padding:14px; border:1px solid var(--border-color); border-radius:12px; background:white; }
    .item a { color:inherit; text-decoration:none; display:flex; gap:12px; align-items:center; flex:1; }
    .count { color:var(--muted-color); font-size:13px; }

    .item-right { display:flex; align-items:center; gap:8px; margin-left:12px; }
    .item-delete-form { margin:0; }
    .item-delete-btn {
      border:none;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      cursor:pointer;
      background:#fee2e2;
      color:#b91c1c;
      font-weight:600;
      white-space:nowrap;
    }
    .item-delete-btn:hover { background:#fecaca; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="wrap">
    <div class="header-bar">
      <div>
        <h1>ìƒë‹´ ê¸°ë¡</h1>
        {% if selected_session %}
          <div class="subtitle">
            {{ selected_session['created_at'] or '' }}ì— ì‹œì‘ëœ
            {{ (selected_session['title'] or (selected_session['id'] ~ "íšŒì°¨")) }}ì˜ ëŒ€í™”ì…ë‹ˆë‹¤.
          </div>
          <div class="session-chip">ğŸ—‚ï¸ {{ (selected_session['title'] or (selected_session['id'] ~ "íšŒì°¨")) }}</div>
        {% else %}
          <div class="subtitle">ë‚˜ì˜ ìƒë‹´ íšŒì°¨ ëª©ë¡</div>
        {% endif %}
      </div>
      <div class="toolbar">
        {% if selected_session %}
          <!-- ì„ íƒëœ íšŒì°¨ ì‚­ì œ ë²„íŠ¼ -->
          <form
            action="{{ url_for('history_delete', sid=selected_session['id']) }}"
            method="post"
            onsubmit="return confirm('ì´ ìƒë‹´ íšŒì°¨ë¥¼ ì •ë§ ì‚­ì œí• ê¹Œìš”? ë˜ëŒë¦´ ìˆ˜ ì—†ì–´ìš” ğŸ˜¢');">
            <button type="submit" class="btn btn-danger">íšŒì°¨ ì‚­ì œ</button>
          </form>
          <a class="btn" href="{{ url_for('history') }}">â—€ íšŒì°¨ ëª©ë¡</a>
        {% endif %}
        <a class="btn btn-primary" href="{{ url_for('chatbot') }}">ìƒë‹´ ê³„ì†í•˜ê¸°</a>
      </div>
    </div>

    {% if sessions %}
      <!-- ëª©ë¡ ëª¨ë“œ -->
      <div class="card">
        <div class="list">
          {% for s in sessions %}
            <div class="item">
              <a href="{{ url_for('history_detail', sid=s.id) }}">
                <div>ğŸ—‚ï¸ <strong>{{ s.title or (s.id ~ "íšŒì°¨") }}</strong></div>
              </a>
              <div class="item-right">
                <div class="count">{{ s.created_at }} Â· {{ s.msg_count }}ê°œ ë©”ì‹œì§€</div>
                <form
                  class="item-delete-form"
                  action="{{ url_for('history_delete', sid=s.id) }}"
                  method="post"
                  onsubmit="return confirm('ì´ ìƒë‹´ íšŒì°¨ë¥¼ ì •ë§ ì‚­ì œí• ê¹Œìš”? ë˜ëŒë¦´ ìˆ˜ ì—†ì–´ìš” ğŸ˜¢');">
                  <button type="submit" class="item-delete-btn">ì‚­ì œ</button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <!-- ìƒì„¸ ëª¨ë“œ -->
      <div class="card">
        <div id="chat-window" class="chat-window">
          {% if not messages or messages|length == 0 %}
            <div class="row">
              <div class="avatar">ğŸš«</div>
              <div class="msg bot">ì´ íšŒì°¨ì—ëŠ” ì•„ì§ ì €ì¥ëœ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
          {% else %}
            {% for m in messages %}
              {% if m.role == 'assistant' %}
                <div class="row">
                  <div class="avatar">ğŸ¤–</div>
                  <div class="msg bot">{{ m.content }}</div>
                </div>
              {% else %}
                <div class="row">
                  <div class="msg user">{{ m.content }}</div>
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>

  <script>
    const chatWindow = document.getElementById('chat-window');
    if (chatWindow) { chatWindow.scrollTop = chatWindow.scrollHeight; }
  </script>
</body>
</html>
